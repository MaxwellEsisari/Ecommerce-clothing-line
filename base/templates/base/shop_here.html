<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Here</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .product-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            margin-bottom: 20px; /* Optional: add margin between rows */
            margin-left: 140px;
        }
        .product-card {
            width: calc(33.33% - 70px); /* Adjust as needed depending on the number of products you want to display in a row */
            margin-bottom: 20px; /* Optional: add margin between products */
            margin-right: 30px; /* Adjust the right margin to reduce spacing between product cards */
            /* You can add additional styling for the product card here */
        }
        .product-card:last-child {
            margin-right: 0; /* Remove the right margin for the last product card in each row */
        }
        h2.category {
            margin-left: 140px; /* Add a margin to the left side of the category headings */
        }
        .product-card .image-container {
            position: relative;
            width: 350px; /* Adjust the width of the image container */
            height: auto; /* Maintain aspect ratio */
            margin-left: 20px;
            margin-top: 15px;
            border-radius: 8px; /* Add border-radius for rounded corners */
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1); /* Add shadow for depth */
            overflow: hidden; /* Hide overflow content (image2) */
        }
        .product-card .image-container img {
            width: 100%; /* Ensure the image takes the full width of the container */
            height: auto; /* Maintain aspect ratio */
            object-fit: cover; /* Maintain aspect ratio and cover entire container */
            object-position: center; /* Center the image within the container */
            transition: transform 0.3s ease; /* Smooth transition effect for zoom */
        }
        .product-card .image-container:hover img:first-child {
            transform: scale(1.05); /* Slightly zoom in when hovering over image1 */
        }
        .product-card .image-container img.hover-image {
            position: absolute; /* Position image2 on top of image1 */
            top: 0;
            left: 0;
            opacity: 0; /* Initially hidden */
            transition: opacity 0.3s ease; /* Smooth transition effect for opacity */
        }
        .product-card .image-container:hover img.hover-image {
            opacity: 1; /* Show image2 when hovering over image1 */
        }
        .price {
            color: #524e4d; /* Set the text color to orange */
            font-weight: bold; /* Set the font weight to bold */
            font-style:oblique;
            font-size: 15px; /* Set the font size */
        }
        /* Style for the cart button */
        .cart-container {
            position: fixed;
            top: 20px; /* Adjust as needed */
            right: 20px; /* Adjust as needed */
            z-index: 1000; /* Ensure it's above other content */
        }
        .cart-icon {
            position: relative;
            cursor: pointer;
        }
        .cart-count {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: red;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
        }
        .favorite-icon {
            position: absolute;
            top: 5px;
            left:3px;
            fill: red; /* Change color as needed */
            cursor: pointer;
        }

        .favorite-icon:hover {
            fill: rgb(51, 6, 6);
            }
    </style>
</head>
<body>

    <div class="cart-container">
        <div class="cart-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star favorite-icon" viewBox="0 0 16 16" onclick="addToFavorites('{{ product.id }}', '{{ product.name }}', '{{ product.description }}', '{{ product.image1.url }}', '{{ product.image2.url }}')">
                <path d="M6.5 7a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1z"/>
                <path d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1zm3.915 10L3.102 4h10.796l-1.313 7zM6 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0m7 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
            </svg>
            <sup id="cartCount" class="cart-count">0</sup>
        </div>
    </div>

    {% for category, products in categories.items %}
        <h2 class="category">{{ category }}</h2>
        <div class="product-container">
            {% for product in products %}
                <div class="product-card">
                    <div class="card mb-4 shadow-sm">
                           <!-- Favorite icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star favorite-icon" viewBox="0 0 16 16" onclick="addToFavoritesAndRedirect('{{ product.id }}', '{{ product.name }}', '{{ product.description }}', '{{ product.image1.url }}')">
                            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.56.56 0 0 0-.163-.505L1.71 6.745l4.052-.576a.53.53 0 0 0 .393-.288L8 2.223l1.847 3.658a.53.53 0 0 0 .393.288l4.052.575-2.906 2.77a.56.56 0 0 0-.163.506l.694 3.957-3.686-1.894a.5.5 0 0 0-.461 0z"/>
                          </svg>
                        <div class="image-container">
                            <img src="{{ product.image1.url }}" class="card-img-top" alt="{{ product.name }}">
                            {% if product.image2 %}
                            <img src="{{ product.image2.url }}" class="hover-image" alt="{{ product.name }}">
                            {% endif %}
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">{{ product.name }}</h5>
                            <p class="card-text" onclick="viewProductDetail('{{ product.id }}')">{{ product.description }}</p>
                            <p class="card-text price"> ksh {{ product.price }}</p>
                        <!-- Add to Cart button -->
                        <button onclick="addToCart('{{ product.id }}', '{{ product.name }}', '{{ product.price }}')" class="btn btn-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cart-dash" viewBox="0 0 16 16">
                                <path d="M6.5 7a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1z"/>
                                <path d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1zm3.915 10L3.102 4h10.796l-1.313 7zM6 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0m7 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
                            </svg> Add to Cart
                        </button>                                      
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% endfor %}


<script>
    function addToFavoritesAndRedirect(productId, productName, productPrice, productDescription, productImage1, productImage2) {
        // Create an object to store product data
        const favoriteProduct = {
            id: productId,
            name: productName,
            price: productPrice,
            description: productDescription,
            image1: productImage1,
            image2: productImage2
        };

        // Get existing favorites from local storage
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

        // Add the new favorite product
        favorites.push(favoriteProduct);

        // Save back to local storage
        localStorage.setItem('favorites', JSON.stringify(favorites));

        // Redirect to index.html
        // window.location.href = 'index.html';
    }
</script>


<script>
    function addToCart(productId) {
    var formData = new FormData();
    formData.append('product_id', productId);

    fetch('/add_to_cart/', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': getCookie('csrftoken')
        }
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        } else {
            throw new Error('Failed to add product to cart');
        }
    })
    .then(data => {
        var cartCount = document.getElementById('cartCount');
        var count = parseInt(cartCount.innerText);
        cartCount.innerText = count + 1;

        // Redirect to cart page after successful addition
        window.location.href = '/shop_here/cart/';
    })
    .catch(error => {
        console.error('Error:', error);
    });
}


</script>
</body>
</html>
